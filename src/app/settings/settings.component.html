<div class="card !pt-5">
  <p-table
    [columns]="cols"
    [value]="courses()"
    [tableStyle]="{ 'min-width': '50rem' }"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5, 10, 20]"
  >
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns">{{ col.header }}</th>
        <th colspan="3">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-columns="columns">
      <tr>
        <td *ngFor="let col of columns">{{ rowData[col.field] }}</td>
        <td>
          <p-button label="Invite" (click)="showCourse(rowData)"></p-button>
        </td>
        <td>
          <p-button label="Edit" (click)="openEditModal(rowData)"></p-button>
        </td>
        <td>
          <p-button label="Delete" severity="danger" (click)="openDeleteModal(rowData)"></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div class="flex gap-2 mt-4 justify-center !mt-2">
  <p-button label="Add Course" icon="pi pi-plus" (click)="openAddModal()"></p-button>
</div>


<!-- ADD COURSE MODAL -->
<p-dialog header="Kurs hinzufügen" [modal]="true" [(visible)]="addModalVisible" [style]="{ width: 'auto' }"
          [closable]="true" [dismissableMask]="true">

  <div class="card flex justify-center">
    <p-stepper [value]="1" class="">
      <p-step-list>
        <p-step [value]="1">Raum anlegen</p-step>
        <p-step [value]="2">Bild hochladen</p-step>
        <p-step [value]="3">Audio aufnehmen</p-step>
        <p-step [value]="4">Dateien hochladen</p-step>
      </p-step-list>
      <p-step-panels>
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col h-48">
              <div
                class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50  flex-auto flex justify-center items-center font-medium"
              >
                <div class="p-fluid">
                  <div class="p-field !pb-3">
                    <label for="courseID" class="!pr-5">Kurs ID</label>
                    <input id="courseID" type="text" pInputText [(ngModel)]="newCourse.courseID"/>
                  </div>
                  <div class="p-field !pb-5">
                    <label for="name" class="!pr-5">Name</label>
                    <input id="name" type="text" pInputText [(ngModel)]="newCourse.name"/>
                  </div>
                </div>
              </div>
              <div class="flex !pt-6 justify-end">
                <p-button label="Next" icon="pi pi-arrow-right" iconPos="right" (onClick)="activateCallback(2)"/>
              </div>
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="2">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col h-48">
              <div
                class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50  flex-auto flex justify-center items-center font-medium"
              >
                <div class="card flex justify-center">
                  <p-fileupload mode="basic"
                                name="demo[]"
                                chooseIcon="pi pi-upload"
                                accept="image/*"
                                maxFileSize="10000000"
                                (onSelect)="onImageSelect($event)"
                                (onUpload)="onBasicUploadAuto($event)"
                                [auto]="true"
                                chooseLabel="Browse"

                  />
                </div>
                <!-- Image preview with download on click -->
                <div *ngIf="previewUrl" style="margin-top: 1rem;">
                  <a [href]="previewUrl" download="image.png">
                    <img
                      [src]="previewUrl"
                      alt="Uploaded Image"
                      style="max-width: 300px; border: 1px solid #ccc; padding: 5px; cursor: pointer;"
                    />
                  </a>
                </div>
              </div>
            </div>
            <div class="flex !pt-6 justify-between">
              <p-button label="Back" severity="secondary" icon="pi pi-arrow-left" (onClick)="activateCallback(1)"/>
              <p-button label="Next" icon="pi pi-arrow-right" iconPos="right" (onClick)="activateCallback(3)"/>
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="3">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col h-48">
              <div
                class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50  flex-auto flex justify-center items-center font-medium"
              >
                <div class="audio ">

                  <p-button class="!p-3" (click)="startRecording()" label="️Start Aufnahme" severity="primary"
                            icon="pi pi-microphone" [disabled]="isRecording"/>
                  <p-button class="!p-3" (click)="stopRecording()" label="Stop" severity="primary"
                            icon="pi pi-pause-circle" [disabled]="!isRecording"/>


                  <div *ngIf="audioUrl" style="margin-top: 1rem;">
                    <audio [src]="audioUrl" controls></audio>
                  </div>

                </div>
              </div>
            </div>
            <div class="flex !pt-6 justify-between">
              <p-button label="Back" severity="secondary" icon="pi pi-arrow-left" (onClick)="activateCallback(2)"/>
              <p-button label="Next" icon="pi pi-arrow-right" iconPos="right" (onClick)="activateCallback(4)"/>
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="4">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col h-auto">
              <div
                class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50 0 flex-auto flex justify-center items-center font-medium"
              >
                <div class="card">

                  <p-fileupload
                    #uploader
                    name="demo[]"
                    [customUpload]="true"
                    [multiple]="true"
                    accept="image/*,application/pdf"
                    maxFileSize="100000000"
                    mode="advanced"
                    (uploadHandler)="onMockUpload($event, uploader)"
                  >
                    <ng-template pTemplate="empty">
                      <div>Drag and drop files here to mock upload.</div>
                    </ng-template>
                  </p-fileupload>
                </div>

                <!-- Listbox für Dateinamen -->
                <div class="card flex justify-center mt-4">
                  <p-listbox
                    [options]="files()"
                    [(ngModel)]="selectedFile"
                    optionLabel="name"
                    class="w-full md:w-64"
                    (onChange)="onFileSelect($event)"
                  ></p-listbox>
                </div>
              </div>
            </div>
            <div class="flex !pt-6 justify-start">
              <p-button label="Back" icon="pi pi-arrow-left" iconPos="right" (onClick)="activateCallback(3)"/>
            </div>
            <div class="flex justify-end gap-2 mt-4">
              <p-button label="Abbrechen" class="p-button-text" (click)="addModalVisible = false"></p-button>
              <p-button label="Kurs hinzufügen" severity="danger" (click)="addCourse()"></p-button>
            </div>
          </ng-template>
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </div>


</p-dialog>


<!-- EDIT COURSE MODAL -->
<p-dialog header="Kurs bearbeiten" [modal]="true" [(visible)]="editModalVisible" [style]="{ width: '30rem' }"
          [closable]="true" [dismissableMask]="true">
  <div class="p-fluid">
    <div class="p-field !pb-3">
      <label for="editCourseID" class="!pr-5">Kurs ID</label>
      <input id="editCourseID" type="text" pInputText [(ngModel)]="editedCourse.courseID"/>
    </div>
    <div class="p-field !pb-5">
      <label for="editName" class="!pr-5">Name</label>
      <input id="editName" type="text" pInputText [(ngModel)]="editedCourse.name"/>
    </div>
  </div>
  <div class="flex justify-end gap-2 mt-4 ">
    <p-button label="Abbrechen" class="p-button-text" (click)="editModalVisible = false"></p-button>
    <p-button label="Kurs bearbeiten" severity="danger" (click)="updateCourse()"></p-button>
  </div>
</p-dialog>

<!-- DELETE COURSE MODAL -->
<p-dialog header="Kurs löschen" [modal]="true" [(visible)]="deleteModalVisible" [style]="{ width: '50rem' }"
          [closable]="true" [dismissableMask]="true">
  <p>Wollen Sie wirklich den Kurs <b>{{ selectedCourse?.name }}</b> löschen?</p>
  <div class="flex justify-end gap-2 mt-4 !pt-3">
    <p-button label="Abbrechen" class="p-button-text" (click)="deleteModalVisible = false"></p-button>
    <p-button label="Kurs löschen" severity="danger" (click)="deleteCourse()"></p-button>
  </div>
</p-dialog>


